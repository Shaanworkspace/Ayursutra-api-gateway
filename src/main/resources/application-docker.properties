spring.application.name=api-gateway
server.port=${PORT:8085}

# ==========================================
# ROUTES WITH GATEWAY HEADER
# ==========================================

# Doctor Service
spring.cloud.gateway.server.webflux.routes[0].id=doctor-service
spring.cloud.gateway.server.webflux.routes[0].uri=${DOCTOR_SERVICE_URL:http://localhost:8081}
spring.cloud.gateway.server.webflux.routes[0].predicates[0]=Path=/api/doctors/**
spring.cloud.gateway.server.webflux.routes[0].filters[0]=AddRequestHeader=X-Gateway-Request, true
spring.cloud.gateway.server.webflux.routes[0].filters[1]=RemoveResponseHeader=Access-Control-Allow-Origin
spring.cloud.gateway.server.webflux.routes[0].filters[2]=RemoveResponseHeader=Access-Control-Allow-Credentials
spring.cloud.gateway.server.webflux.routes[0].filters[3]=RemoveResponseHeader=Access-Control-Allow-Methods
spring.cloud.gateway.server.webflux.routes[0].filters[4]=RemoveResponseHeader=Access-Control-Allow-Headers

# Patient Service
spring.cloud.gateway.server.webflux.routes[1].id=patient-service
spring.cloud.gateway.server.webflux.routes[1].uri=${PATIENT_SERVICE_URL:http://localhost:8082}
spring.cloud.gateway.server.webflux.routes[1].predicates[0]=Path=/api/patients/**
spring.cloud.gateway.server.webflux.routes[1].filters[0]=AddRequestHeader=X-Gateway-Request, true
spring.cloud.gateway.server.webflux.routes[1].filters[1]=RemoveResponseHeader=Access-Control-Allow-Origin
spring.cloud.gateway.server.webflux.routes[1].filters[2]=RemoveResponseHeader=Access-Control-Allow-Credentials
spring.cloud.gateway.server.webflux.routes[1].filters[3]=RemoveResponseHeader=Access-Control-Allow-Methods
spring.cloud.gateway.server.webflux.routes[1].filters[4]=RemoveResponseHeader=Access-Control-Allow-Headers

# Therapist Service
spring.cloud.gateway.server.webflux.routes[2].id=therapist-service
spring.cloud.gateway.server.webflux.routes[2].uri=${THERAPIST_SERVICE_URL:http://localhost:8083}
spring.cloud.gateway.server.webflux.routes[2].predicates[0]=Path=/api/therapists/**
spring.cloud.gateway.server.webflux.routes[2].filters[0]=AddRequestHeader=X-Gateway-Request, true
spring.cloud.gateway.server.webflux.routes[2].filters[1]=RemoveResponseHeader=Access-Control-Allow-Origin
spring.cloud.gateway.server.webflux.routes[2].filters[2]=RemoveResponseHeader=Access-Control-Allow-Credentials
spring.cloud.gateway.server.webflux.routes[2].filters[3]=RemoveResponseHeader=Access-Control-Allow-Methods
spring.cloud.gateway.server.webflux.routes[2].filters[4]=RemoveResponseHeader=Access-Control-Allow-Headers

# User Service
spring.cloud.gateway.server.webflux.routes[3].id=user-service
spring.cloud.gateway.server.webflux.routes[3].uri=${USER_SERVICE_URL:http://localhost:8086}
spring.cloud.gateway.server.webflux.routes[3].predicates[0]=Path=/api/user/**
spring.cloud.gateway.server.webflux.routes[3].filters[0]=AddRequestHeader=X-Gateway-Request, true
spring.cloud.gateway.server.webflux.routes[3].filters[1]=RemoveResponseHeader=Access-Control-Allow-Origin
spring.cloud.gateway.server.webflux.routes[3].filters[2]=RemoveResponseHeader=Access-Control-Allow-Credentials
spring.cloud.gateway.server.webflux.routes[3].filters[3]=RemoveResponseHeader=Access-Control-Allow-Methods
spring.cloud.gateway.server.webflux.routes[3].filters[4]=RemoveResponseHeader=Access-Control-Allow-Headers

# Health Route (No filters needed)
spring.cloud.gateway.server.webflux.routes[4].id=health-route
spring.cloud.gateway.server.webflux.routes[4].uri=${API_SERVICE_URL:http://localhost:8085}
spring.cloud.gateway.server.webflux.routes[4].predicates[0]=Path=/api/health

# ==========================================
# GLOBAL CORS (Gateway Level)
# ==========================================
spring.cloud.gateway.server.webflux.globalcors.cors-configurations.[/**].allowed-origins=http://localhost:5173,http://localhost:3000,https://ayursutra-frontend.netlify.app
spring.cloud.gateway.server.webflux.globalcors.cors-configurations.[/**].allowed-methods=GET,POST,PUT,DELETE,PATCH,OPTIONS,HEAD
spring.cloud.gateway.server.webflux.globalcors.cors-configurations.[/**].allowed-headers=*
spring.cloud.gateway.server.webflux.globalcors.cors-configurations.[/**].exposed-headers=Authorization,Content-Type
spring.cloud.gateway.server.webflux.globalcors.cors-configurations.[/**].allow-credentials=true
spring.cloud.gateway.server.webflux.globalcors.cors-configurations.[/**].max-age=3600
spring.cloud.gateway.server.webflux.globalcors.add-to-simple-url-handler-mapping=true

# Deduplicate Headers
spring.cloud.gateway.server.webflux.default-filters[0]=DeduplicateResponseHeader=Access-Control-Allow-Origin Access-Control-Allow-Credentials Access-Control-Allow-Methods Access-Control-Allow-Headers, RETAIN_FIRST

# ==========================================
# PERFORMANCE
# ==========================================
spring.main.lazy-initialization=true
spring.main.banner-mode=off
logging.level.org.springframework=INFO
logging.level.org.springframework.cloud.gateway=DEBUG
logging.level.reactor.netty=ERROR
spring.webflux.base-path=/
reactor.netty.ioWorkerCount=2
reactor.netty.pool.maxConnections=50