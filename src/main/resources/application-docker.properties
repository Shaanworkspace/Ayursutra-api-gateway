# ===============================
#  Basic Service Information
# ===============================
spring.application.name=api-gateway
server.port=${PORT:8085}

# ===============================
#  Eureka Discovery Configuration
# ===============================
eureka.client.service-url.defaultZone=${EUREKA_SERVER_URL}
eureka.client.register-with-eureka=true
eureka.client.fetch-registry=true

# ===============================
#  Zipkin Tracing Configuration
# ===============================
management.tracing.sampling.probability=1.0

# ===============================
#  Gateway Routes (Service Discovery)
# ===============================
spring.cloud.gateway.server.webflux.routes[0].id=doctor-service
spring.cloud.gateway.server.webflux.routes[0].uri=lb://DOCTOR-SERVICE
spring.cloud.gateway.server.webflux.routes[0].predicates[0]=Path=/api/doctors/**

spring.cloud.gateway.server.webflux.routes[1].id=patient-service
spring.cloud.gateway.server.webflux.routes[1].uri=lb://PATIENT-SERVICE
spring.cloud.gateway.server.webflux.routes[1].predicates[0]=Path=/api/patients/**

spring.cloud.gateway.server.webflux.routes[2].id=therapist-service
spring.cloud.gateway.server.webflux.routes[2].uri=lb://THERAPIST-SERVICE
spring.cloud.gateway.server.webflux.routes[2].predicates[0]=Path=/api/therapists/**

spring.cloud.gateway.server.webflux.routes[3].id=medicalrecord-service
spring.cloud.gateway.server.webflux.routes[3].uri=lb://MEDICALRECORD-SERVICE
spring.cloud.gateway.server.webflux.routes[3].predicates[0]=Path=/api/medical-records/**

# ===============================
#  Eureka UI via Gateway (Docker-safe)
# ===============================
spring.cloud.gateway.server.webflux.routes[4].id=eureka-server
spring.cloud.gateway.server.webflux.routes[4].uri=http://eureka-server:8761
spring.cloud.gateway.server.webflux.routes[4].predicates[0]=Path=/eureka/**
spring.cloud.gateway.server.webflux.routes[4].filters[0]=SetPath=/

# ===============================
# Logging
# ===============================
logging.level.root=INFO
logging.level.org.springframework.cloud.gateway=TRACE

# ===============================
#  OAuth2 / Keycloak
# ===============================
#spring.security.oauth2.resourceserver.jwt.issuer-uri=${KEYCLOAK_ISSUER_URI}

keycloak.realm=ayursutra-realm
keycloak.auth-server-url=${KEYCLOAK_AUTH_SERVER}

keycloak.client-id=${KEYCLOAK_CLIENT_ID}
keycloak.client-secret=${KEYCLOAK_CLIENT_SECRET}

keycloak.user-token-url=${KEYCLOAK_USER_TOKEN_URL}
keycloak.admin-token-url=${KEYCLOAK_ADMIN_TOKEN_URL}
keycloak.addUser-url=${KEYCLOAK_ADD_USER_URL}

keycloak.grant-type=password
keycloak.realm.jwks-url=${JWKS_URL}
keycloak.realm.public-key=${KEYCLOAK_PUBLIC_KEY}

# ===============================
#  CORS
# ===============================
spring.cloud.gateway.server.webflux.globalcors.cors-configurations.[/**].allowed-origins=${CORS_ALLOWED_ORIGINS}
spring.cloud.gateway.server.webflux.globalcors.cors-configurations.[/**].allowed-methods=GET,POST,PUT,DELETE,OPTIONS
spring.cloud.gateway.server.webflux.globalcors.cors-configurations.[/**].allowed-headers=*
spring.cloud.gateway.server.webflux.globalcors.cors-configurations.[/**].allow-credentials=true



